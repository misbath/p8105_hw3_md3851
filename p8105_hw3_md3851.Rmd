---
title: "p8105_hw3_md3851"
author: "Misbath Daouda"
date: "10/3/2019"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(viridis)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```


##Problem 1


```{r}
library(p8105.datasets)
data("instacart")
head(instacart)
str(instacart)

```

Instacart is an online grocery service that allows customers to shop online from local stores. This dataset contains `r nrow(instacart)` observations of `r ncol(instacart)` variables from `r n_distinct(pull(instacart, user_id))` users. Such variables include `reordered`, a binary variable indicating if an item has been ordered by this user in the past, and `order_dow`, the day of the week on which the order was placed. 

As an example of the information provided, the first order was for bulgarian yogurt. It was placed at 10 am on the fourth day of the week, and it had been 9 days since the customer had last purchased it. 

```{r}
#Number of aisles 
n_distinct(pull(instacart, aisle_id))


#Aisles with most orders  
instacart %>% 
   group_by(aisle) %>% 
   summarize(n = n()) %>%
   mutate(
     ranking = min_rank(desc(n))
   ) %>% 
   arrange(ranking) %>%
   filter(ranking < 4)
```

There are 134 aisles in this supermarket. Most items are ordered from the fresh vegetables, the fresh fruits, and the packaged vegetables and fruits aisles. 

```{r}
#Aisles with more than 10000 items ordered 
instacart %>% 
   group_by(aisle) %>% 
   summarize(n = n()) %>%
   filter(n > 10000) %>%
   ggplot(aes(x = aisle, y = n)) +
   geom_col() +
   theme(axis.text.x = element_text(angle = 90)) +
   labs(x = "Aisle", y = "Number of Products Ordered", title = "Number of Products Ordered by Aisle")
  
```

This plot shows the number of items ordered in each aisle, limiting this to aisles with more than 10000 items ordered. The aisles are presented in alphabetical order. We can see that the most demanded products are fresh produce. The demand for packaged produce and yogurt is also high compared to other items, but is only about half as high as that of fresh produce.

```{r}
#Three most popular items
instacart %>%
   filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
   group_by(aisle, product_name) %>%
   summarize(n = n()) %>%
   mutate(ranking = rank(-n)) %>% 
   filter(ranking <= 3) %>% 
   arrange(aisle, ranking) %>% 
   knitr::kable() 
```

This table shows that the most popular items in the “baking ingredients”, “dog food care”, and “packaged vegetables fruits” aisles are light brown sugar, snack sticks chicken & rice recipe dog treats, and organic baby spinach respectively. Although these are the most popular items in each of these aisles, there are notable differences in the number of orders for each of them. For instance, there were 30 orders of snack sticks chicken & rice recipe dog treats versus 9784 orders of organic baby spinach. 

```{r}
#Apples and coffee
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>% 
  summarize(
  mean_hr = mean(order_hour_of_day)) %>% 
  pivot_wider(
  names_from = order_dow,
  values_from = mean_hr
  ) %>%
  knitr::kable()
```

This table shows the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week. On most days (except for day 5), and on average, coffee ice cream is ordered later in the afternoon than pink lady apples. This makes sense as ice cream tends to be an afternoon craving. 



##Problem 2

```{r}
library(p8105.datasets)
data("brfss_smart2010")

str(brfss_smart2010)
head(brfss_smart2010)

#Cleaning 

brfss_cleaned = brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>% 
  filter(response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>%
  mutate(
    response = forcats::fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))
  ) %>% 
  view()

#Answering questions 

brfss_2002 = 
  brfss_cleaned %>%
  filter(year == 2002) %>% 
  group_by(locationabbr) %>% 
  summarize(n = n()) %>%
  filter(n >= 7)

list(pull(brfss_2002, locationabbr))

brfss_2010 = 
  brfss_cleaned %>%
  filter(year == 2010) %>%
  group_by(locationabbr) %>% 
  summarize(n = n()) %>%
  filter(n >= 7) 

list(pull(brfss_2010, locationabbr))

brfss_excellent = 
  brfss_cleaned %>%
  select(response, year, locationabbr, data_value) %>%
  filter(response == "Excellent") %>% 
  group_by(locationabbr, year) %>% 
  mutate(
    mean_dv = mean(data_value)
  ) %>%
  select(-data_value) %>%
  distinct() %>%
  view()
 
spaghetti_plot = brfss_excellent %>% 
  ggplot(aes(x = year, y = mean_dv, group = locationabbr, color = locationabbr)) + geom_line()
spaghetti_plot

brfss_NY = 
  brfss_cleaned %>%
  filter(year == "2006" | year == "2010") %>%
  filter(locationabbr == "NY") %>%
  select(response, year, locationdesc, data_value) 
  
brfss_NY %>% 
  ggplot(aes(x = response, y = data_value)) +
  geom_boxplot() + 
  facet_grid (year ~ locationdesc)

#NY_plot
```

##Problem 3

```{r}
accel_data = read_csv("./data/accel_data.csv") %>%
janitor::clean_names() %>%
pivot_longer(
  activity_1:activity_1440,
  names_to = "minute",
  names_prefix = "activity_",
  values_to = "activity_counts"
  )%>%
  mutate(weekend = if_else(day == "Saturday" | day == "Sunday", "weekend", "weekday"))

view(accel_data)

daily_data =
  accel_data %>% 
  group_by(day_id) %>% 
  mutate(
    daily_activity = sum(activity_counts)
  )%>%
  select(day_id, day, weekend, daily_activity)%>%
  distinct()
  
view(daily_data)

```

